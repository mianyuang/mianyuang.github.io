<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>redux-状态管理 | 小高笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link ref="icon" href="/favicon.ico">
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.35bcedcf.css" as="style"><link rel="preload" href="/assets/js/app.d13f59f1.js" as="script"><link rel="preload" href="/assets/js/2.53646e3a.js" as="script"><link rel="preload" href="/assets/js/8.37f8fc14.js" as="script"><link rel="prefetch" href="/assets/js/10.5ccc8fdd.js"><link rel="prefetch" href="/assets/js/11.aa33a8de.js"><link rel="prefetch" href="/assets/js/12.993b4d84.js"><link rel="prefetch" href="/assets/js/13.5507d9bc.js"><link rel="prefetch" href="/assets/js/14.0048d491.js"><link rel="prefetch" href="/assets/js/15.0455f1d1.js"><link rel="prefetch" href="/assets/js/16.f911e976.js"><link rel="prefetch" href="/assets/js/17.2510d920.js"><link rel="prefetch" href="/assets/js/18.e2e23205.js"><link rel="prefetch" href="/assets/js/19.d5043b46.js"><link rel="prefetch" href="/assets/js/20.07b6a18c.js"><link rel="prefetch" href="/assets/js/21.60063212.js"><link rel="prefetch" href="/assets/js/22.0bc5fe12.js"><link rel="prefetch" href="/assets/js/23.9a2edd04.js"><link rel="prefetch" href="/assets/js/24.dac6e202.js"><link rel="prefetch" href="/assets/js/25.156ad714.js"><link rel="prefetch" href="/assets/js/26.b27149f5.js"><link rel="prefetch" href="/assets/js/27.6d559b79.js"><link rel="prefetch" href="/assets/js/28.c42a444d.js"><link rel="prefetch" href="/assets/js/29.4836f5f1.js"><link rel="prefetch" href="/assets/js/3.bb50f79a.js"><link rel="prefetch" href="/assets/js/30.37b5d171.js"><link rel="prefetch" href="/assets/js/31.919c37fa.js"><link rel="prefetch" href="/assets/js/32.c5479266.js"><link rel="prefetch" href="/assets/js/33.ef7cdcee.js"><link rel="prefetch" href="/assets/js/34.0d49d121.js"><link rel="prefetch" href="/assets/js/35.a96ba84d.js"><link rel="prefetch" href="/assets/js/36.280625b4.js"><link rel="prefetch" href="/assets/js/37.a1358acd.js"><link rel="prefetch" href="/assets/js/38.d6dbc7ba.js"><link rel="prefetch" href="/assets/js/39.97b4bcfd.js"><link rel="prefetch" href="/assets/js/4.35661e66.js"><link rel="prefetch" href="/assets/js/40.684a77c3.js"><link rel="prefetch" href="/assets/js/41.5ef9d50f.js"><link rel="prefetch" href="/assets/js/42.444f193c.js"><link rel="prefetch" href="/assets/js/43.e6bf2917.js"><link rel="prefetch" href="/assets/js/44.6241887c.js"><link rel="prefetch" href="/assets/js/45.ee459281.js"><link rel="prefetch" href="/assets/js/46.42a39b62.js"><link rel="prefetch" href="/assets/js/47.96607b08.js"><link rel="prefetch" href="/assets/js/48.2dc75c63.js"><link rel="prefetch" href="/assets/js/49.1404ad3e.js"><link rel="prefetch" href="/assets/js/5.2a73e3c3.js"><link rel="prefetch" href="/assets/js/50.eaa708d4.js"><link rel="prefetch" href="/assets/js/51.813059e2.js"><link rel="prefetch" href="/assets/js/52.b2b30732.js"><link rel="prefetch" href="/assets/js/53.83e35218.js"><link rel="prefetch" href="/assets/js/54.5114b1c2.js"><link rel="prefetch" href="/assets/js/55.31992a29.js"><link rel="prefetch" href="/assets/js/56.9d768f0f.js"><link rel="prefetch" href="/assets/js/57.ed73a721.js"><link rel="prefetch" href="/assets/js/58.be77d415.js"><link rel="prefetch" href="/assets/js/59.8ef3b6a8.js"><link rel="prefetch" href="/assets/js/6.191aaf39.js"><link rel="prefetch" href="/assets/js/60.4fd87fd0.js"><link rel="prefetch" href="/assets/js/61.361e594c.js"><link rel="prefetch" href="/assets/js/62.3801fa63.js"><link rel="prefetch" href="/assets/js/63.fb124fab.js"><link rel="prefetch" href="/assets/js/64.bdb473d5.js"><link rel="prefetch" href="/assets/js/65.8b14388b.js"><link rel="prefetch" href="/assets/js/66.6ad4e223.js"><link rel="prefetch" href="/assets/js/67.caf1ddfb.js"><link rel="prefetch" href="/assets/js/68.84d22d1b.js"><link rel="prefetch" href="/assets/js/69.2411fe3a.js"><link rel="prefetch" href="/assets/js/7.029c4464.js"><link rel="prefetch" href="/assets/js/70.b310e685.js"><link rel="prefetch" href="/assets/js/71.0e077ea4.js"><link rel="prefetch" href="/assets/js/72.2b6d7f80.js"><link rel="prefetch" href="/assets/js/73.c3e37b24.js"><link rel="prefetch" href="/assets/js/9.9b32826c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35bcedcf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">小高笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/pages/miscellaneous/reg/reg.html" class="nav-link">
  杂记
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/frontend/htmlcssLearn.html" class="nav-link">
  html+css3+移动前端
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/js.html" class="nav-link">
  javaScript
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/jses6.html" class="nav-link">
  javaScript-es6
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/ts.html" class="nav-link">
  typeScript
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/nodejs.html" class="nav-link">
  nodeJs
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/webpack/webpack.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/react/react.html" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/vue/vue.html" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/backend/java.html" class="nav-link">
  java
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/pages/miscellaneous/reg/reg.html" class="nav-link">
  杂记
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/frontend/htmlcssLearn.html" class="nav-link">
  html+css3+移动前端
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/js.html" class="nav-link">
  javaScript
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/jses6.html" class="nav-link">
  javaScript-es6
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/ts.html" class="nav-link">
  typeScript
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/nodejs.html" class="nav-link">
  nodeJs
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/webpack/webpack.html" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/react/react.html" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/pages/frontend/vue/vue.html" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/backend/java.html" class="nav-link">
  java
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>react</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/frontend/react/jsx语法规则/jsx语法规则.html" class="sidebar-link">jsx语法规则</a></li><li><a href="/pages/frontend/react/React面向组件编程/React面向组件编程.html" class="sidebar-link">React面向组件编程</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>react应用</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/frontend/react/react应用/React应用-基于React脚手架.html" class="sidebar-link">React应用-基于React脚手架</a></li><li><a href="/pages/frontend/react/react应用/React脚手架配置代理/React脚手架配置代理.html" class="sidebar-link">React脚手架配置代理</a></li><li><a href="/pages/frontend/react/react应用/消息订阅-发布机制/消息订阅-发布机制.html" class="sidebar-link">消息订阅-发布机制</a></li><li><a href="/pages/frontend/react/react应用/React-路由/React-路由.html" class="sidebar-link">React-路由</a></li><li><a href="/pages/frontend/react/react应用/redux-状态管理/redux-状态管理.html" class="active sidebar-link">redux-状态管理</a></li><li><a href="/pages/frontend/react/react应用/React-路由6版本/React-路由6版本.html" class="sidebar-link">React-路由6版本</a></li></ul></section></li><li><a href="/pages/frontend/react/react拓展/react拓展.html" class="sidebar-link">react拓展</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redux-状态管理"><a href="#redux-状态管理" class="header-anchor">#</a> redux-状态管理</h1> <h4 id="什么是redux"><a href="#什么是redux" class="header-anchor">#</a> 什么是redux</h4> <p>redux是一个专门用于做状态管理的js库（不是react插件库），它可以应用在vue，react，angular等项目中。</p> <p>作用：集中式管理react应用中多个组件共享的状态。</p> <h4 id="什么情况下需要使用redux"><a href="#什么情况下需要使用redux" class="header-anchor">#</a> 什么情况下需要使用redux</h4> <ol><li><p><strong>某个组件的状态，需要让其他组件可以随时拿到（共享）</strong></p></li> <li><p>一个组件需要改变另一个组件的状态（通信）</p></li> <li><p>总体原则：能不用就不用，如果不用比较吃力才考虑使用</p></li></ol> <h4 id="redux原理图"><a href="#redux原理图" class="header-anchor">#</a> redux原理图</h4> <p><img src="/assets/img/1.55eebbe4.png" alt=""></p> <h4 id="redux的三个核心"><a href="#redux的三个核心" class="header-anchor">#</a> redux的三个核心</h4> <p><strong>action</strong></p> <ol><li><p>动作的对象</p></li> <li><p>包含的属性</p> <ol><li>type:</li></ol></li> <li><p>例子：{type:'ADD_STUDENT',data:{name:'xxx',age:18}}</p></li></ol> <p><strong>reducer</strong></p> <ol><li><p>用于初始化状态、加工状态</p></li> <li><p>加工时，根据旧的state和action，产生新的state的纯函数</p></li></ol> <p><strong>store</strong></p> <ol><li><p>将state、action、reducer联系在一起的对象</p></li> <li><p>如何得到此对象？</p> <ol><li><p><code>import {createStore} from 'redux'</code></p></li> <li><p><code>import reducer from './reducers'</code></p></li> <li><p><code>const store = createStore(reducer)</code></p></li></ol></li> <li><p>此对象的功能</p> <ol><li><p>getState():得到state</p></li> <li><p>dispatch(action)：分发action，触发reducer调用，产生新的state</p></li> <li><p>subscribe(listener)：注册监听，当产生新的state时，自动调用</p></li></ol></li></ol> <h4 id="例子-选择数字进行求和"><a href="#例子-选择数字进行求和" class="header-anchor">#</a> 例子：选择数字进行求和</h4> <p><img src="/assets/img/2.094e8b0d.png" alt=""></p> <p><strong>简单版redux使用</strong></p> <ol><li><p>创建<code>redux/store.js</code>文件，暴露store对象</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>import { createStore } from 'redux'
import countReducer from './count_reducer'
export default createStore(countReducer)//使用countReducer
</code></pre></div></li> <li><p>创建<code>redux/count_reducer.js</code>文件，创建<code>Count</code>组件需要使用的<code>reducer</code>进行数据加工</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>const initState = 0
export default function countReducer(preState=initState,action){
    const {type,data} = action
    switch (type) {
        case 'increment':
            return preState+data*1
        case 'decrement':
            return preState-data*1
        default:
            return preState
    }
}
</code></pre></div></li> <li><p>使用<code>dispatch</code>函数通知redux进行数据加工操作</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>increatAdd=()=&gt;{
        const {value} = this.selectRef.current
        store.dispatch({type:'increment',data:value})
    }
    decreat=()=&gt;{
        const {value} = this.selectRef.current
        store.dispatch({type:'decrement',data:value})
    }
    increatAddIfodd=()=&gt;{
        const {value} = this.selectRef.current
        const sum = store.getState()
        if(sum%2 !== 0){
          store.dispatch({type:'increment',data:value})
        }
       
    }
    increatAddSync=()=&gt;{
        const {value} = this.selectRef.current
        setTimeout(()=&gt;{
          store.dispatch({type:'increment',data:value})
        },500)
        
    }
</code></pre></div></li> <li><p>使用<code>subscribe</code>监听reudx状态改变时触发页面的重新渲染</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>const root = ReactDOM.createRoot(document.getElementById(&quot;root&quot;));
root.render(&lt;App /&gt;);

store.subscribe(() =&gt; {
  const root = ReactDOM.createRoot(document.getElementById(&quot;root&quot;));
  root.render(&lt;App /&gt;);
});
</code></pre></div></li></ol> <p><strong>完整版redux****写法</strong></p> <ol><li><p>创建<code>redux/store.js</code>文件，暴露store对象</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>import { createStore } from 'redux'
import countReducer from './count_reducer'
export default createStore(countReducer)//使用countReducer
</code></pre></div></li> <li><p>创建<code>redux/count_reducer.js</code>文件，创建<code>Count</code>组件需要使用的<code>reducer</code>进行数据加工</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>const initState = 0
export default function countReducer(preState=initState,action){
    const {type,data} = action
    switch (type) {
        case 'increment':
            return preState+data*1
        case 'decrement':
            return preState-data*1
        default:
            return preState
    }
}
</code></pre></div></li> <li><p>创建<code>redux/count_action.js</code>文件，创建Count组件的action</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>export const incrementAction = data=&gt;({type:'increment',data})
export const decrementAction = data=&gt;({type:'decrement',data})

</code></pre></div></li> <li><p>使用<code>dispatch</code>函数通知redux进行数据加工操作，通过aciton来传递action动作对象</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>increatAdd=()=&gt;{
        const {value} = this.selectRef.current
        store.dispatch(incrementAction(value*1))
    }
    decreat=()=&gt;{
        const {value} = this.selectRef.current
        store.dispatch(decrementAction(value*1))
    }
    increatAddIfodd=()=&gt;{
        const {value} = this.selectRef.current
        const sum = store.getState()
        if(sum%2 !== 0){
          store.dispatch(incrementAction(value*1))
        }
       
    }
    increatAddSync=()=&gt;{
        const {value} = this.selectRef.current
        setTimeout(()=&gt;{
          store.dispatch(incrementAction(value*1))
        },500)
        
    }
</code></pre></div></li> <li><p>使用<code>subscribe</code>监听reudx状态改变时触发页面的重新渲染</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>const root = ReactDOM.createRoot(document.getElementById(&quot;root&quot;));
root.render(&lt;App /&gt;);

store.subscribe(() =&gt; {
  const root = ReactDOM.createRoot(document.getElementById(&quot;root&quot;));
  root.render(&lt;App /&gt;);
});
</code></pre></div></li></ol> <h4 id="异步action"><a href="#异步action" class="header-anchor">#</a> 异步action</h4> <p>action返回的不是一个普通的对象类型，返回的是一个函数，可称之为异步action。</p> <p>使用方式：</p> <ol><li><p>明确：延迟的动作不想在组件自身，想交给action</p></li> <li><p>何时需要异步action：想要对状态进行操作，但是具体的数据靠异步任务返回</p></li> <li><p>具体编码：</p> <ol><li><p>要安装使用redux-thunk中间件，配置在store中。因为store会检查如果不是一个普通的对象，则校验不过，不会转到reducer进行加工操作。</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>import { createStore,applyMiddleware } from 'redux'
import countReducer from './count_reducer'
import reduxThunk from 'redux-thunk'
export default createStore(countReducer,applyMiddleware(reduxThunk))
//使用applyMiddleware函数增加中间件thunk
</code></pre></div></li> <li><p>创建action函数不再返回一个对象，而是返回一个函数，函数内部编写异步任务。</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code> export const incrementAsyncAction = (data,time)=&gt;{
    return (dispatch)=&gt;{
        setTimeout(()=&gt;{
            //异步任务有结果后，在使用dispatch分发一个同步action去操作数据。
            dispatch(incrementAction(data))
        },time)
    }
 }
</code></pre></div></li></ol></li></ol> <h4 id="react-redux"><a href="#react-redux" class="header-anchor">#</a> react-redux</h4> <p><img src="/assets/img/3.03732d3c.png" alt=""></p> <h4 id="react-redux使用"><a href="#react-redux使用" class="header-anchor">#</a> react-redux使用</h4> <ol><li><p>创建容器组件，一般放于<code>containers</code>文件夹中，创建Count容器组件</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>//引入UI组件
import CountUI from '../../components/Count'
//引入connet用于连接UI组件和redux
import {connect} from 'react-redux'

import {incrementAction,decrementAction,incrementAsyncAction} from '../../redux/count_action'

//容器组件从redux获取状态转化为props传递给UI组件
//1、接收state，相当于调用此方法会调用getState()赋值给state作为参数传入
//2、因为是传递给UI组件的props属性，需要返回key-value形式的对象
//3、mapStateToProps用于传递状态
function mapStateToProps(state){
    return {count:state}
}
//容器组件把操作状态的方法转化为props传递给UI组件
//1、接收一个dispatch函数，用于分发操作state数据加工
//2、因为是传递给UI组件的props属性，需要返回key-value形式的对象，value为函数
//3、mapDispatchToProps用于传递操作状态的方法
function mapDispatchToProps(dispatch){
    return {
        jia:data=&gt;dispatch(incrementAction(data)),
        jian:data=&gt;dispatch(decrementAction(data)),
        jiaAsync:(data,time)=&gt;{dispatch(incrementAsyncAction(data,time))}
    }
}

//使用connet()()暴露一个Count的容器组件
export default connect(mapStateToProps,mapDispatchToProps)(CountUI)
</code></pre></div></li> <li><p>使用容器组件连接store</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>import React, { Component } from 'react'
import Count from './containers/Count'
import store from './redux/store'
export default class App extends Component {
  render() {
    return (
      &lt;Count store={store}/&gt;
    )
  }
}

</code></pre></div></li> <li><p>在UI组件中使用容器组件传递过来的props</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>  increatAdd=()=&gt;{
        const {value} = this.selectRef.current
        this.props.jia(value*1)
    }
    decreat=()=&gt;{
        const {value} = this.selectRef.current
        this.props.jian(value*1)
    }
    increatAddIfodd=()=&gt;{
        const {value} = this.selectRef.current
        if(this.props.count%2!==0){
          this.props.jia(value*1)
        }
    }
    increatAddSync=()=&gt;{
        const {value} = this.selectRef.current
        this.props.jiaAsync(value*1,500)
    }
</code></pre></div></li></ol> <p>总结：</p> <ol><li><p>明确概念</p> <ol><li><p>UI组件：不能使用任何redux的API，只负责页面的呈现、交互</p></li> <li><p>容器组件：负责和redux通信，将结果交给UI组件</p></li></ol></li> <li><p>如何创建一个容器组件-靠react-redux的connect函数</p> <p><code>connect(mapStateToProps,mapDispatchToProps)(UI组件)</code></p> <p><code>mapStateToProps</code>：映射状态，返回是一个对象</p> <p><code>mapDispatchToProps</code>：映射状态操作方法，返回值是一个对象</p></li> <li><p>容器组件的store是靠props传递进去的，不是在容器组件直接引入</p></li></ol> <h4 id="react-redux优化"><a href="#react-redux优化" class="header-anchor">#</a> react-redux优化</h4> <p>****<strong>优化</strong></p> <p><code>connect(mapStateToProps,mapDispatchToProps)(UI组件)</code>的<code>mapDispatchToProps</code>可以接收两个类型的参数，一个是对象，一个是函数，传递对象时，<code>react-redux</code>会根据你传入的<code>action</code>自动分发调用<code>dispatch</code>传递action到store，store通知reducer进行操作。</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>//mapDispatchToProps简写形式
connect(state=&gt;({count:state}),
{
  jia:incrementAction,
  jian:decrementAction
}
)(CountUI)
</code></pre></div><p><strong>Provider组件的使用</strong></p> <p>只要使用上react-redux，容器组件提供检测状态变化重新渲染页面，不需要在自己监听react状态的变化来重新渲染页面。</p> <p>如果其他组件还需要使用store，则需要编写多个store：</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>import React, { Component } from 'react'
import Count from './containers/Count'
import store from './redux/store'
export default class App extends Component {
  render() {
    return (
      &lt;div&gt;
         &lt;Count store={store}/&gt;
         &lt;Hello store={store}/&gt;
      &lt;/div&gt;
     
    )
  }
}

</code></pre></div><p>使用provider可以避免上面情况，也就是只需要只写一次store，就可以让所有需要使用store的组件都可以使用上。</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>import React from &quot;react&quot;;
import ReactDOM from &quot;react-dom/client&quot;;
import App from &quot;./App&quot;;
import { Provider } from &quot;react-redux&quot;;
import store from &quot;./redux/store&quot;;
const root = ReactDOM.createRoot(document.getElementById(&quot;root&quot;));
root.render(
  &lt;Provider store={store}&gt;
    &lt;App /&gt;
  &lt;/Provider&gt;
);
</code></pre></div><p><strong>UI组件和容器组件的整合</strong></p> <p>把UI组件和容器组件写到一个文件里，暴露容器组件。</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>//引入connet用于连接UI组件和redux
import { connect } from &quot;react-redux&quot;;
import React, { Component } from &quot;react&quot;;

import {
  incrementAction,
  decrementAction,
  incrementAsyncAction,
} from &quot;../../redux/count_action&quot;;

//定义UI组件
class Count extends Component {
    selectRef = React.createRef()
    increatAdd=()=&gt;{
        const {value} = this.selectRef.current
        this.props.jia(value*1)
    }
    decreat=()=&gt;{
        const {value} = this.selectRef.current
        this.props.jian(value*1)
    }
    increatAddIfodd=()=&gt;{
        const {value} = this.selectRef.current
        if(this.props.count%2!==0){
          this.props.jia(value*1)
        }
    }
    increatAddSync=()=&gt;{
        const {value} = this.selectRef.current
        this.props.jiaAsync(value*1,500)
    }
  render() {
    return (
      &lt;div&gt;
        &lt;h2&gt;当前求和为：{this.props.count}&lt;/h2&gt;
        &lt;select ref={this.selectRef}&gt;
          &lt;option value={1}&gt;1&lt;/option&gt;
          &lt;option value={2}&gt;2&lt;/option&gt;
          &lt;option value={3}&gt;3&lt;/option&gt;
        &lt;/select&gt;&amp;nbsp;
        &lt;button onClick={this.increatAdd}&gt;+&lt;/button&gt;&amp;nbsp;
        &lt;button onClick={this.decreat}&gt;-&lt;/button&gt;&amp;nbsp;
        &lt;button onClick={this.increatAddIfodd}&gt;当前求和奇数加&lt;/button&gt;&amp;nbsp;
        &lt;button onClick={this.increatAddSync}&gt;异步加&lt;/button&gt;&amp;nbsp;
      &lt;/div&gt;
    );
  }
}

//使用connet()()暴露一个Count的容器组件
export default connect((state) =&gt; ({ count: state }), {
  jia: incrementAction,
  jian: decrementAction,
  jiaAsync: incrementAsyncAction,
})(Count);

</code></pre></div><h4 id="多个组件共享redux状态数据写法"><a href="#多个组件共享redux状态数据写法" class="header-anchor">#</a> 多个组件共享redux状态数据写法</h4> <ol><li><p>创建多个组件</p></li> <li><p>为每一个组件编写reducer、action</p></li> <li><p>重点：在store里使用<code>combineReducers</code>进行多个组件reducer的合并，合并后返回的总状态时一个对象！</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>const allReducer = combineReducers({
  sum:counterReducer,
  persons:personReducer
})
export default createStore(allReducer)
</code></pre></div></li> <li><p>交给store的是合并后的reducer</p></li></ol> <h4 id="react-redux开发者工具的使用"><a href="#react-redux开发者工具的使用" class="header-anchor">#</a> react-redux开发者工具的使用</h4> <ol><li><p>安装redux-devtools-extension</p></li> <li><p>store中配置 </p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>import {composeWithDevTools} from 'redux-devtools-extension'
const store = createStore(allReducer,composeWithDevTools(applyMiddleware(thunk)))
</code></pre></div></li></ol> <h4 id="补充redux-toolkit"><a href="#补充redux-toolkit" class="header-anchor">#</a> 补充Redux ToolKit</h4> <p> 使用redux ToolKit可以简化开发。可以让toolkit工具库去自动生成reducer、action。</p> <p>使用如下：</p> <ol><li><p>安装相关依赖</p> <ol><li>npm install @reduxjs/toolkit</li></ol></li> <li><p>编写store配置</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>import {configureStore} from &quot;@reduxjs/toolkit&quot;
import countReducer from &quot;./slices/cont&quot;

export default configureStore({reducer:countReducer})
</code></pre></div></li> <li><p>编写slice相关配置</p> <div class="language-react&amp;#x20;jsx extra-class"><pre class="language-text"><code>import { createSlice } from &quot;@reduxjs/toolkit&quot;;
export const countSlice = createSlice({
    name:'count',
    initialState:0,
    reducers:{
        increment:(preState,action)=&gt; preState+action.payload*1,
        decrement:(preState,action)=&gt; preState-action.payload*1
    }
})

export const {increment,decrement} = countSlice.actions

export const incrementAsyncAction = (data,time)=&gt;(dispatch)=&gt;{
    setTimeout(()=&gt;{
        dispatch(increment(data*1))
    },time)
}
export default countSlice.reducer
</code></pre></div><p>说明：</p> <p>通过slice切片reduxToolKit 工具会自动生成reducer、action</p> <ol><li><p>name属性的value值和reducers的属性key组合成action的type。</p></li> <li><p>reducers的属性key变成action的函数名</p></li> <li><p>reducers属性的value变成reducer</p></li></ol></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/frontend/react/react应用/React-路由/React-路由.html" class="prev">
        React-路由
      </a></span> <span class="next"><a href="/pages/frontend/react/react应用/React-路由6版本/React-路由6版本.html">
        React-路由6版本
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d13f59f1.js" defer></script><script src="/assets/js/2.53646e3a.js" defer></script><script src="/assets/js/8.37f8fc14.js" defer></script>
  </body>
</html>
